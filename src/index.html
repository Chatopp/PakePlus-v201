<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç»†èƒè†œæµåŠ¨é•¶åµŒæ¨¡å‹ - äº¤äº’å¼æ•™å­¦ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden; /* é¡µé¢ä¸å‡ºç°æ¨ªå‘æ»šåŠ¨ */
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #1565c0;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .header p {
            color: #546e7a;
            font-size: 1.1em;
        }

        .header .meta-author {
            color: #78909c;
            font-size: 0.95em;
            margin-top: 4px;
        }

        .main-content {
            display: grid;
            grid-template-columns: minmax(0, 1fr) clamp(240px, 28vw, 300px); /* è‡ªé€‚åº”å³ä¾§åˆ—ï¼Œç¡®ä¿ä¸æº¢å‡º */
            grid-template-rows: auto 1fr;     /* é¡¶éƒ¨ç»„ä»¶æ  + ä¸‹æ–¹ç”»å¸ƒ */
            gap: 20px;
            align-items: start;
        }

        .component-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            height: fit-content;
            grid-column: 1;
            grid-row: 1;
        }

        .component-strip {
            display: flex;                    /* å•æ’æ°´å¹³æ’åˆ— */
            flex-wrap: nowrap;                /* ä¸æ¢è¡Œï¼Œè¶…å‡ºåˆ™æ»šåŠ¨ */
            gap: 6px;                         /* ç¼©å°å¡ç‰‡é—´è· */
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
            overscroll-behavior-x: contain;   /* åªåœ¨æ­¤å¤„æ°´å¹³æ»šåŠ¨ï¼Œä¸è”åŠ¨é¡µé¢ */
        }
        .component-strip::-webkit-scrollbar { height: 8px; }
        .component-strip::-webkit-scrollbar-thumb { background: #c5d7f2; border-radius: 8px; }
        .component-strip::-webkit-scrollbar-track { background: #eef3fb; }

        .component-panel h2 {
            color: #1565c0;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e3f2fd;
        }

        .component-item {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 6px;                     /* æ›´ç´§å‡‘çš„å†…è¾¹è· */
            margin-bottom: 0;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
            user-select: none;
            width: 100px;       /* å°æ­£æ–¹å½¢å¡ç‰‡ */
            min-width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }

        .component-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
            border-color: #2196f3;
            background: #e3f2fd;
        }

        .component-item.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .component-item.selected {
            border-color: #1976d2;
            background: #e3f2fd;
            box-shadow: 0 4px 12px rgba(25,118,210,0.25);
        }

        .component-visual {
            width: 100%;
            height: 56px;                     /* å°æ­£æ–¹å½¢ä¸­æ›´æ¸…æ™°çš„é¢„è§ˆåŒº */
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .component-visual svg { width: 48px; height: 48px; }

        .component-name {
            display: block;                   /* ç®€çŸ­åç§°æ˜¾ç¤º */
            width: 100%;
            text-align: center;
            font-weight: 600;
            color: #37474f;
            font-size: 11px;                 /* æ›´å°å­—å· */
            line-height: 1.1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .component-desc { display: none; }

        .membrane-builder {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            grid-column: 1;
            grid-row: 2;
        }

        .builder-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }

        .builder-header h2 {
            color: #1565c0;
            font-size: 1.4em;
        }

        .control-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-icon {
            padding: 8px 10px;
            font-size: 12px;
            border-radius: 8px;
            background: #e9eef6;
            color: #0f172a;
        }
        .btn-icon.active { background: #cfe1ff; color: #0b3d91; }

        .btn-preset {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-preset:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }

        .btn-save { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); color:#fff; }
        .btn-save:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0, 176, 155, 0.35); }
        .btn-load { background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%); color:#fff; }
        .btn-load:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255, 94, 98, 0.35); }

        

        .btn-motion {
            background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);
            color: white;
        }
        .btn-motion.active {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: #0b3d2e;
        }

        #membraneCanvas {
            width: 100%;
            height: 500px;
            background: #ffffff;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            border: 3px dashed #90caf9;
            transition: all 0.3s ease;
            overscroll-behavior: contain; /* é˜²æ­¢è§¦æ§æ»šåŠ¨é“¾åˆ°é¡µé¢ */
        }

        /* Studio æ¨¡å¼ï¼šæ›´åƒå»ºæ¨¡å¹³å°çš„è§†è§‰ */
        #membraneCanvas.studio {
            background: radial-gradient(1200px 600px at 30% 30%, #111927 0%, #0b1220 60%, #0a0f1a 100%);
            border: 1px solid #243247;
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.03), 0 10px 30px rgba(0,0,0,0.25);
        }

        /* ç”»å¸ƒå†…å®¹å®¹å™¨ï¼šç»Ÿä¸€ç¼©æ”¾å¯¹è±¡ */
        #canvasContent {
            position: absolute;
            inset: 0;
            transform-origin: center center;
            touch-action: none; /* å…è®¸è‡ªå®šä¹‰å¤šæŒ‡æ‰‹åŠ¿ï¼ˆpinch/panï¼‰ */
        }

        /* ç½‘æ ¼è¦†ç›–å±‚ï¼ˆè·Ÿéšç¼©æ”¾ï¼‰ */
        .grid-overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            opacity: 0.22;
            display: none;
            background-image:
              linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px),
              linear-gradient(rgba(255,255,255,0.08) 1px, transparent 1px),
              linear-gradient(90deg, rgba(255,255,255,0.08) 1px, transparent 1px);
            background-size: 10px 10px, 10px 10px, 50px 50px, 50px 50px;
            background-position: 0 0, 0 0, 0 0, 0 0;
        }

        /* åº•éƒ¨çŠ¶æ€æ  */
        .status-bar {
            margin-top: 8px;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 12px;
            color: #334155;
            background: #f1f5f9;
            display: flex;
            gap: 12px;
            align-items: center;
        }
        #membraneCanvas.studio + .status-bar { background: #0f172a; color: #cbd5e1; border: 1px solid #243247; }

        /* æ“ä½œæç¤º */
        .op-hint {
            margin-top: 10px;
            font-size: 12px;
            color: #607d8b;
            background: #f8fafc;
            border: 1px dashed #e2e8f0;
            padding: 8px 10px;
            border-radius: 8px;
        }

        #membraneCanvas.placing {
            cursor: crosshair;
            border-color: #1976d2;
        }

        #membraneCanvas.drag-over {
            border-color: #1976d2;
            background: #ffffff;
            box-shadow: inset 0 0 30px rgba(25, 118, 210, 0.2);
        }

        .membrane-layer {
            position: absolute;
            width: 100%;
            height: 200px;
            top: 50%;
            left: 0;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .placed-component {
            position: absolute;
            cursor: move;
            transition: filter 0.3s ease;
            z-index: 10;
            user-select: none;
        }

        .placed-component:hover {
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3)) brightness(1.1);
            z-index: 20;
        }

        .info-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            height: fit-content;
            grid-column: 2;
            grid-row: 1 / span 2;
            min-width: 240px;
        }

        .info-panel h2 {
            color: #1565c0;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #e3f2fd;
        }

        .stats-grid {
            display: grid;
            gap: 12px;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            align-items: stretch;
        }

        .stat-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 12px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-weight: 600;
            color: #37474f;
            font-size: 0.95em;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.2em;
            color: #1565c0;
            background: white;
            padding: 2px 10px;
            border-radius: 15px;
        }

        .knowledge-card {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
        }

        .knowledge-card h3 {
            color: #f57c00;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .knowledge-card p {
            color: #5d4037;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .tooltip {
            position: absolute;
            background: rgba(33, 33, 33, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(5px);
        }

        /* åˆ é™¤åŒå‡»åˆ é™¤çš„æç¤ºï¼Œé¿å…é®æŒ¡è§†é‡ */

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .floating { animation: float 3s ease-in-out infinite; }
        .pulsing { animation: pulse 2s ease-in-out infinite; }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }
            .component-panel { grid-column: 1; grid-row: 1; }
            .membrane-builder { grid-column: 1; grid-row: 2; }
            .info-panel { grid-column: 1; grid-row: 3; max-width: 100%; }
        }
    </style>
    </head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§¬ ç»†èƒè†œæµåŠ¨é•¶åµŒæ¨¡å‹ - äº¤äº’å¼æ•™å­¦ç³»ç»Ÿ</h1>
            <div class="meta-author">åˆ¶ä½œä¿¡æ¯ï¼šé¥¶åç¥¯ Â· å¹¿æ˜Œå¿ç¬¬ä¸€ä¸­å­¦</div>
        </div>

        <div class="main-content">
            <div class="component-panel">
                <h2>ğŸ“¦ è†œç»“æ„ç»„ä»¶</h2>
                <div class="component-strip">

                <!-- ç£·è„‚åˆ†å­ï¼ˆæ­£ç½®ï¼‰ -->
                <div class="component-item" draggable="true" data-type="phospholipid-up" data-name="ç£·è„‚åˆ†å­ï¼ˆæ­£ç½®ï¼‰" title="ç£·è„‚åˆ†å­ï¼ˆæ­£ç½®ï¼‰ï¼šå¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <circle cx="20" cy="15" r="8" fill="#64B5F6"/>
                            <path d="M15 25 C 12 32, 18 38, 15 45 C 12 50, 18 55, 15 58" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <path d="M25 25 C 28 32, 22 38, 25 45 C 28 50, 22 55, 25 58" stroke="#EF5350" stroke-width="2.5" fill="none"/>

                            <circle cx="60" cy="15" r="8" fill="#64B5F6"/>
                            <path d="M55 25 C 52 32, 58 38, 55 45 C 52 50, 58 55, 55 58" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <path d="M65 25 C 68 32, 62 38, 65 45 C 68 50, 62 55, 65 58" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                        </svg>
                    </div>
                    <div class="component-name">ç£·è„‚(æ­£)</div>
                    <div class="component-desc">å¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…ï¼Œæ„æˆä¸Šå±‚</div>
                </div>

                <!-- ç£·è„‚åˆ†å­ï¼ˆå€’ç½®ï¼‰ -->
                <div class="component-item" draggable="true" data-type="phospholipid-down" data-name="ç£·è„‚åˆ†å­ï¼ˆå€’ç½®ï¼‰" title="ç£·è„‚åˆ†å­ï¼ˆå€’ç½®ï¼‰ï¼šå¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…ï¼ˆä¸‹å±‚ï¼‰">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <circle cx="20" cy="45" r="8" fill="#64B5F6"/>
                            <path d="M15 35 C 12 28, 18 22, 15 15 C 12 10, 18 5, 15 2" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <path d="M25 35 C 28 28, 22 22, 25 15 C 28 10, 22 5, 25 2" stroke="#EF5350" stroke-width="2.5" fill="none"/>

                            <circle cx="60" cy="45" r="8" fill="#64B5F6"/>
                            <path d="M55 35 C 52 28, 58 22, 55 15 C 52 10, 58 5, 55 2" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <path d="M65 35 C 68 28, 62 22, 65 15 C 68 10, 62 5, 65 2" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                        </svg>
                    </div>
                    <div class="component-name">ç£·è„‚(å€’)</div>
                    <div class="component-desc">å¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…ï¼Œæ„æˆä¸‹å±‚</div>
                </div>

                <div class="component-item" draggable="true" data-type="integral-protein" data-name="è·¨è†œè›‹ç™½" title="è·¨è†œè›‹ç™½ï¼šåµŒå…¥å¹¶ç©¿è¿‡è„‚åŒå±‚">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <path d="M28 8 C 24 18, 24 42, 28 52 L52 52 C 56 42, 56 18, 52 8 Z" fill="#9575CD" opacity="0.95"/>
                        </svg>
                    </div>
                    <div class="component-name">è·¨è†œè›‹ç™½</div>
                    <div class="component-desc">è´¯ç©¿æ•´ä¸ªè„‚åŒå±‚ï¼Œå‚ä¸ç‰©è´¨è¿è¾“å’Œä¿¡å·ä¼ å¯¼</div>
                </div>

                <div class="component-item" draggable="true" data-type="peripheral-protein" data-name="å¤–å‘¨è›‹ç™½" title="å¤–å‘¨è›‹ç™½ï¼šé™„ç€è†œå†…å¤–è¡¨é¢ï¼Œä¸ç©¿è¿‡è†œ">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <ellipse cx="40" cy="30" rx="24" ry="14" fill="#B39DDB" opacity="0.95"/>
                        </svg>
                    </div>
                    <div class="component-name">å¤–å‘¨è›‹ç™½</div>
                    <div class="component-desc">é™„ç€åœ¨è†œçš„å†…å¤–è¡¨é¢ï¼Œä¸ç©¿è¿‡è„‚åŒå±‚</div>
                </div>

                <div class="component-item" draggable="true" data-type="glycoprotein" data-name="ç³–è›‹ç™½" title="ç³–è›‹ç™½ï¼šä¸»é“¾å‘ä¸Š + å³ä¾§é•¿æ”¯é“¾ï¼Œå…­è¾¹å½¢ç³–ç›¸è¿ï¼Œæ— è¿çº¿">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <rect x="30" y="28" width="20" height="27" rx="6" fill="#7CB342" opacity="0.9"/>
                            <!-- ä¸»é“¾ä¸Šçš„å…­è¾¹å½¢ç³–ï¼ˆç›¸é‚»æ’åˆ—ï¼Œæ— è¿çº¿ï¼‰ -->
                            <polygon points="43,24 41.5,21.4 38.5,21.4 37,24 38.5,26.6 41.5,26.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="43,18 41.5,15.4 38.5,15.4 37,18 38.5,20.6 41.5,20.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="43,12 41.5,9.4 38.5,9.4 37,12 38.5,14.6 41.5,14.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="43,6 41.5,3.4 38.5,3.4 37,6 38.5,8.6 41.5,8.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <!-- å³ä¾§æ”¯é“¾ä¸Šçš„ 6 ä¸ªå…­è¾¹å½¢ç³–ï¼ˆæ²¿æ–œå‘æ’åˆ—ï¼Œæ— è¿çº¿ï¼‰ -->
                            <polygon points="49,20.5 47.5,17.9 44.5,17.9 43,20.5 44.5,23.1 47.5,23.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="53,18.5 51.5,15.9 48.5,15.9 47,18.5 48.5,21.1 51.5,21.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="57,16.5 55.5,13.9 52.5,13.9 51,16.5 52.5,19.1 55.5,19.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="61,14.5 59.5,11.9 56.5,11.9 55,14.5 56.5,17.1 59.5,17.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="65,12.5 63.5,9.9 60.5,9.9 59,12.5 60.5,15.1 63.5,15.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="69,10.5 67.5,7.9 64.5,7.9 63,10.5 64.5,13.1 67.5,13.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="73,8.5 71.5,5.9 68.5,5.9 67,8.5 68.5,11.1 71.5,11.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="77,6.5 75.5,3.9 72.5,3.9 71,6.5 72.5,9.1 75.5,9.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                        </svg>
                    </div>
                    <div class="component-name">ç³–è›‹ç™½</div>
                    <div class="component-desc">ä¸€æ¡ä¸»é“¾ + å³ä¾§è¾ƒé•¿æ”¯é“¾ï¼ˆâ‰¥6 å…­è¾¹å½¢ç³–ï¼‰</div>
                </div>

                <div class="component-item" draggable="true" data-type="glycolipid" data-name="ç³–è„‚" title="ç³–è„‚ï¼šä¸»é“¾ä¸Šå»¶ + å³ä¾§é•¿æ”¯é“¾ï¼Œå…­è¾¹å½¢ç³–ç›¸è¿ï¼Œæ— è¿çº¿">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <!-- æ©™çº¢è‰²ç–æ°´å°¾ï¼ˆæ³¢æµªï¼‰ + å¤´éƒ¨ -->
                            <circle cx="40" cy="35" r="6" fill="#FF7043"/>
                            <path d="M35 41 C 32 46, 38 50, 35 54" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <path d="M45 41 C 48 46, 42 50, 45 54" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                            <!-- ä¸»é“¾ä¸Šçš„å…­è¾¹å½¢ç³–ï¼ˆç›¸é‚»æ’åˆ—ï¼‰ -->
                            <polygon points="43,25 41.5,22.4 38.5,22.4 37,25 38.5,27.6 41.5,27.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="43,19 41.5,16.4 38.5,16.4 37,19 38.5,21.6 41.5,21.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="43,13.5 41.5,10.9 38.5,10.9 37,13.5 38.5,16.1 41.5,16.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <!-- å³ä¾§æ”¯é“¾ä¸Šçš„ 6 ä¸ªå…­è¾¹å½¢ç³–ï¼ˆæ–œå‘æ’åˆ—ï¼‰ -->
                            <polygon points="49,21 47.5,18.4 44.5,18.4 43,21 44.5,23.6 47.5,23.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="53,19 51.5,16.4 48.5,16.4 47,19 48.5,21.6 51.5,21.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="57,17 55.5,14.4 52.5,14.4 51,17 52.5,19.6 55.5,19.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="61,15 59.5,12.4 56.5,12.4 55,15 56.5,17.6 59.5,17.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="65,13 63.5,10.4 60.5,10.4 59,13 60.5,15.6 63.5,15.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="69,11 67.5,8.4 64.5,8.4 63,11 64.5,13.6 67.5,13.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="73,9 71.5,6.4 68.5,6.4 67,9 68.5,11.6 71.5,11.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                            <polygon points="77,7 75.5,4.4 72.5,4.4 71,7 72.5,9.6 75.5,9.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                        </svg>
                    </div>
                    <div class="component-name">ç³–è„‚</div>
                    <div class="component-desc">ä¸€æ¡ä¸»é“¾ + å³ä¾§è¾ƒé•¿æ”¯é“¾ï¼ˆâ‰¥6 å…­è¾¹å½¢ç³–ï¼‰</div>
                </div>

                <div class="component-item" draggable="true" data-type="cholesterol" data-name="èƒ†å›ºé†‡" title="èƒ†å›ºé†‡ï¼šä½äºè„‚åŒå±‚ä¸­ï¼Œè°ƒèŠ‚æµåŠ¨æ€§">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <!-- è¾ƒå°çš„åˆšæ€§ç¯çŠ¶ç»“æ„ï¼ˆé»„è‰²ï¼‰ -->
                            <polygon points="40,18 48,24 48,36 40,42 32,36 32,24" fill="#FFB300" opacity="0.95"/>
                            <circle cx="40" cy="30" r="4.5" fill="#F57C00"/>
                        </svg>
                    </div>
                    <div class="component-name">èƒ†å›ºé†‡</div>
                    <div class="component-desc">è°ƒèŠ‚è†œçš„æµåŠ¨æ€§å’Œç¨³å®šæ€§</div>
                </div>

                <div class="component-item" draggable="true" data-type="channel-protein" data-name="é€šé“è›‹ç™½" title="ç¦»å­é€šé“ï¼šå½¢æˆè´¯ç©¿é¦–å°¾çš„äº²æ°´é€šé“">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <!-- è´¯ç©¿å‹é€šé“ï¼šå†…å­”é•‚ç©ºï¼ˆé€æ˜ï¼‰ï¼Œä»é¡¶éƒ¨åˆ°åº•éƒ¨è´¯ç©¿ -->
                            <defs>
                                <mask id="channelMaskIcon">
                                    <rect x="0" y="0" width="80" height="60" fill="white"/>
                                    <!-- é»‘è‰²åŒºåŸŸä¸ºé•‚ç©ºå†…å­”ï¼ˆé¦–å°¾è´¯ç©¿ï¼‰ -->
                                    <rect x="34" y="0" width="12" height="60" rx="6" fill="black"/>
                                </mask>
                            </defs>
                            <rect x="28" y="6" width="24" height="48" rx="10" fill="#9575CD" opacity="0.95" mask="url(#channelMaskIcon)"/>
                        </svg>
                    </div>
                    <div class="component-name">é€šé“è›‹ç™½</div>
                    <div class="component-desc">å½¢æˆäº²æ°´é€šé“ï¼Œå…è®¸ç‰¹å®šç¦»å­é€šè¿‡</div>
                </div>

                <div class="component-item" draggable="true" data-type="carrier-protein" data-name="è½½ä½“è›‹ç™½" title="è½½ä½“è›‹ç™½ï¼šé¦–å°¾è´¯ç©¿ï¼Œå·¦å³å‡¹æ§½ï¼Œæ›´åšå®ï¼›é€šé“æ›´çª„">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                            <defs>
                                <mask id="carrierMaskIcon">
                                    <rect x="0" y="0" width="80" height="60" fill="white"/>
                                    <!-- é¦–å°¾è´¯ç©¿çš„å†…å­” -->
                                    <rect x="36" y="0" width="8" height="60" rx="4" fill="black"/>
                                    <!-- å·¦å³ä¸¤ä¾§åŠåœ†å½¢å‡¹æ§½/ç¼ºå£ -->
                                    <circle cx="36" cy="30" r="4.5" fill="black"/>
                                    <circle cx="44" cy="30" r="4.5" fill="black"/>
                                </mask>
                            </defs>
                            <!-- å¤–éƒ¨ä¸»ä½“æ›´åšå®ï¼ˆå¢å®½ï¼‰ + é•‚ç©ºå†…å­” -->
                            <rect x="25" y="6" width="30" height="48" rx="12" fill="#7E57C2" opacity="0.95" mask="url(#carrierMaskIcon)"/>
                        </svg>
                    </div>
                    <div class="component-name">è½½ä½“è›‹ç™½</div>
                    <div class="component-desc">é¦–å°¾è´¯ç©¿ï¼Œå·¦å³ä¾§å£å‡æœ‰å‡¹æ§½/ç¼ºå£</div>
                </div>

                <!-- æ–°å¢ï¼šå¤šç³–é“¾ï¼ˆå…­è¾¹å½¢ç›¸è¿ï¼Œæ— è¿çº¿ï¼‰ -->
                <div class="component-item" draggable="true" data-type="polysaccharide" data-name="å¤šç³–é“¾" title="å¤šç³–é“¾ï¼šå…­è¾¹å½¢ç³–ç›¸è¿ï¼Œä¸»é“¾æ›´é•¿ï¼Œå³ä¾§æœ‰è¾ƒé•¿æ”¯é“¾">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                <!-- ä¸»é“¾ï¼šçºµå‘ 5 ä¸ªå…­è¾¹å½¢ -->
                <polygon points="43,48 41.5,45.4 38.5,45.4 37,48 38.5,50.6 41.5,50.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,42 41.5,39.4 38.5,39.4 37,42 38.5,44.6 41.5,44.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,36 41.5,33.4 38.5,33.4 37,36 38.5,38.6 41.5,38.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,30 41.5,27.4 38.5,27.4 37,30 38.5,32.6 41.5,32.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,24 41.5,21.4 38.5,21.4 37,24 38.5,26.6 41.5,26.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,18 41.5,15.4 38.5,15.4 37,18 38.5,20.6 41.5,20.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <!-- å³ä¾§è¾ƒé•¿æ”¯é“¾ï¼šâ‰¥6 ä¸ªå…­è¾¹å½¢ï¼Œæ–œå‘æ’åˆ— -->
                <polygon points="49,44.5 47.5,41.9 44.5,41.9 43,44.5 44.5,47.1 47.5,47.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="53,42.5 51.5,39.9 48.5,39.9 47,42.5 48.5,45.1 51.5,45.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="57,40.5 55.5,37.9 52.5,37.9 51,40.5 52.5,43.1 55.5,43.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="61,38.5 59.5,35.9 56.5,35.9 55,38.5 56.5,41.1 59.5,41.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="65,36.5 63.5,33.9 60.5,33.9 59,36.5 60.5,39.1 63.5,39.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="69,34.5 67.5,31.9 64.5,31.9 63,34.5 64.5,37.1 67.5,37.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="73,32.5 71.5,29.9 68.5,29.9 67,32.5 68.5,35.1 71.5,35.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="77,30.5 75.5,27.9 72.5,27.9 71,30.5 72.5,33.1 75.5,33.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                        </svg>
                    </div>
                    <div class="component-name">å¤šç³–é“¾</div>
                    <div class="component-desc">å…­è¾¹å½¢ç›¸è¿çš„é•¿é“¾ï¼Œå³ä¾§é•¿æ”¯é“¾</div>
                </div>

                <!-- æ–°å¢ï¼šå¯¡ç³–é“¾ï¼ˆå…­è¾¹å½¢ç›¸è¿ï¼Œæ— è¿çº¿ï¼‰ -->
                <div class="component-item" draggable="true" data-type="oligosaccharide" data-name="å¯¡ç³–é“¾" title="å¯¡ç³–é“¾ï¼šå…­è¾¹å½¢ç³–ç›¸è¿ï¼Œä¸»é“¾è¾ƒçŸ­ï¼Œå³ä¾§çŸ­æ”¯é“¾">
                    <div class="component-visual">
                        <svg width="80" height="60" viewBox="0 0 80 60">
                <!-- ä¸»é“¾ï¼šçºµå‘ 3 ä¸ªå…­è¾¹å½¢ -->
                <polygon points="43,42 41.5,39.4 38.5,39.4 37,42 38.5,44.6 41.5,44.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,36 41.5,33.4 38.5,33.4 37,36 38.5,38.6 41.5,38.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,30 41.5,27.4 38.5,27.4 37,30 38.5,32.6 41.5,32.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,24 41.5,21.4 38.5,21.4 37,24 38.5,26.6 41.5,26.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <!-- å³ä¾§çŸ­æ”¯é“¾ï¼š2-3 ä¸ªå…­è¾¹å½¢ -->
                <polygon points="49,38.5 47.5,35.9 44.5,35.9 43,38.5 44.5,41.1 47.5,41.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="53,36.5 51.5,33.9 48.5,33.9 47,36.5 48.5,39.1 51.5,39.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="57,34.5 55.5,31.9 52.5,31.9 51,34.5 52.5,37.1 55.5,37.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                        </svg>
                    </div>
                    <div class="component-name">å¯¡ç³–é“¾</div>
                    <div class="component-desc">å…­è¾¹å½¢ç›¸è¿çš„çŸ­é“¾ï¼Œå³ä¾§çŸ­æ”¯é“¾</div>
                </div>
                </div> <!-- /.component-strip -->
                <div class="op-hint">æ“ä½œæç¤ºï¼šç‚¹å‡»å·¦ä¾§ç»„ä»¶é€‰æ‹©ï¼Œå†åœ¨ç”»å¸ƒç‚¹å‡»æ”¾ç½®ï¼ˆäº¦å¯æ‹–æ‹½ï¼‰ã€‚åŒå‡»ç»„ä»¶å¯åˆ é™¤ã€‚</div>
            </div>

            <div class="membrane-builder">
                <div class="builder-header">
                    <h2>ğŸ”¬ è†œç»“æ„ç»„è£…åŒº</h2>
                    <div class="control-buttons">
                        <button class="btn btn-icon" id="studioBtn" onclick="toggleStudio()">å·¥ä½œå°</button>
                        <button class="btn btn-icon" id="gridBtn" onclick="toggleGrid()">ç½‘æ ¼</button>
                        <button class="btn btn-icon" id="snapBtn" onclick="toggleSnap()">å¸é™„</button>
                        <button class="btn btn-icon" onclick="zoomOut()">ç¼©å°</button>
                        <button class="btn btn-icon" onclick="zoomIn()">æ”¾å¤§</button>
                        <button class="btn btn-icon" onclick="resetView()">é‡ç½®è§†å›¾</button>
                        <button class="btn btn-motion" id="motionToggleBtn" onclick="toggleMotion()">å¼€å¯è¿åŠ¨</button>
                        <button class="btn btn-save" onclick="saveCustomPreset()">ä¿å­˜ä¸ºç¤ºä¾‹</button>
                        <button class="btn btn-load" onclick="loadCustomPreset()">åŠ è½½æˆ‘çš„ç¤ºä¾‹</button>
                        <button class="btn btn-preset" onclick="loadPreset()">åŠ è½½ç¤ºä¾‹</button>
                        <button class="btn btn-clear" onclick="clearCanvas()">æ¸…ç©ºç”»å¸ƒ</button>
                    </div>
                </div>

                <div id="membraneCanvas">
                    <div id="canvasContent">
                        <div class="grid-overlay" id="gridOverlay"></div>
                        <div class="membrane-layer" id="membraneBackground"></div>
                    </div>
                </div>
                <div class="status-bar" id="statusBar">
                    <span id="statusPos">X: -ï¼ŒY: -</span>
                    <span id="statusZoom">ç¼©æ”¾: 1.00x</span>
                    <span id="statusFlags">ç½‘æ ¼: å…³ | å¸é™„: å…³</span>
                </div>
            </div>

            <div class="info-panel">
                <h2>ğŸ“Š ç»„è£…ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-label">ç£·è„‚ï¼ˆæ­£ç½®ï¼‰</span>
                        <span class="stat-value" id="phospholipidUpCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç£·è„‚ï¼ˆå€’ç½®ï¼‰</span>
                        <span class="stat-value" id="phospholipidDownCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è·¨è†œè›‹ç™½</span>
                        <span class="stat-value" id="integralProteinCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¤–å‘¨è›‹ç™½</span>
                        <span class="stat-value" id="peripheralProteinCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç³–è›‹ç™½</span>
                        <span class="stat-value" id="glycoproteinCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç³–è„‚</span>
                        <span class="stat-value" id="glycolipidCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">èƒ†å›ºé†‡</span>
                        <span class="stat-value" id="cholesterolCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">é€šé“è›‹ç™½</span>
                        <span class="stat-value" id="channelProteinCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">è½½ä½“è›‹ç™½</span>
                        <span class="stat-value" id="carrierProteinCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¤šç³–é“¾</span>
                        <span class="stat-value" id="polysaccharideCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¯¡ç³–é“¾</span>
                        <span class="stat-value" id="oligosaccharideCount">0</span>
                    </div>
                </div>

                <div class="knowledge-card">
                    <h3>ğŸ’¡ çŸ¥è¯†è¦ç‚¹</h3>
                    <p>
                        <strong>æµåŠ¨é•¶åµŒæ¨¡å‹ï¼š</strong><br>
                        â€¢ ç£·è„‚åŒåˆ†å­å±‚æ„æˆåŸºæœ¬éª¨æ¶<br>
                        â€¢ è›‹ç™½è´¨é•¶åµŒæˆ–é™„ç€åœ¨è„‚åŒå±‚ä¸­<br>
                        â€¢ ç³–é“¾ï¼ˆå¤šç³–/å¯¡ç³–ï¼‰ä½äºç»†èƒè†œå¤–ä¾§<br>
                        â€¢ èƒ†å›ºé†‡è°ƒèŠ‚è†œçš„æµåŠ¨æ€§<br>
                        â€¢ æ•´ä¸ªç»“æ„å…·æœ‰æµåŠ¨æ€§
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // å…¨å±€å˜é‡
        const canvas = document.getElementById('membraneCanvas');
        const content = document.getElementById('canvasContent');
        const gridOverlay = document.getElementById('gridOverlay');
        const statusBar = document.getElementById('statusBar');
        const statusPos = document.getElementById('statusPos');
        const statusZoom = document.getElementById('statusZoom');
        const statusFlags = document.getElementById('statusFlags');
        const tooltip = document.getElementById('tooltip');
        let draggedElement = null;
        let currentView = 'side'; // 'side' æˆ– 'top'
        let componentCounts = {};
        let selectedType = null; // å½“å‰ç‚¹å‡»æ”¾ç½®é€‰æ‹©çš„ç»„ä»¶ç±»å‹
        let selectedItemEl = null; // å·¦ä¾§è¢«é€‰ä¸­çš„é¡¹
        let motionEnabled = false; // åˆ†å­è¿åŠ¨å¼€å…³ï¼Œé»˜è®¤é™æ­¢

        // ç»„ä»¶ä¿¡æ¯å®šä¹‰
        const componentInfo = {
            'phospholipid-up': { name: 'ç£·è„‚åˆ†å­ï¼ˆæ­£ç½®ï¼‰', desc: 'å¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…ï¼Œé€‚ç”¨äºä¸Šå±‚' },
            'phospholipid-down': { name: 'ç£·è„‚åˆ†å­ï¼ˆå€’ç½®ï¼‰', desc: 'å¤´éƒ¨æœå¤–ã€å°¾éƒ¨æœå†…ï¼Œé€‚ç”¨äºä¸‹å±‚' },
            'integral-protein': { name: 'è·¨è†œè›‹ç™½ï¼ˆæ•´åˆè›‹ç™½ï¼‰', desc: 'è´¯ç©¿è„‚åŒå±‚ï¼Œå‚ä¸ç‰©è´¨è¿è¾“å’Œä¿¡å·ä¼ å¯¼' },
            'peripheral-protein': { name: 'å¤–å‘¨è›‹ç™½ï¼ˆè†œå‘¨è›‹ç™½ï¼‰', desc: 'é™„ç€åœ¨è†œçš„å†…å¤–è¡¨é¢ï¼Œä¸ç©¿è¿‡è„‚åŒå±‚' },
            'glycoprotein': { name: 'ç³–è›‹ç™½', desc: 'è›‹ç™½è´¨è¿æ¥ç³–é“¾ï¼Œå‚ä¸ç»†èƒè¯†åˆ«ä¸å…ç–«' },
            'glycolipid': { name: 'ç³–è„‚', desc: 'è„‚è´¨è¿æ¥ç³–é“¾ï¼Œä½äºç»†èƒè†œå¤–ä¾§' },
            'cholesterol': { name: 'èƒ†å›ºé†‡', desc: 'æ’å…¥è„‚åŒå±‚ä¹‹é—´ï¼Œè°ƒèŠ‚è†œçš„æµåŠ¨æ€§ä¸ç¨³å®šæ€§' },
            'channel-protein': { name: 'ç¦»å­é€šé“è›‹ç™½', desc: 'å½¢æˆäº²æ°´å­”é“ï¼Œå…è®¸ç‰¹å®šç¦»å­é€‰æ‹©æ€§é€šè¿‡' },
            'carrier-protein': { name: 'è½½ä½“è›‹ç™½', desc: 'é¦–å°¾è´¯ç©¿ï¼Œå¹¶åœ¨é€šé“å†…å…·æœ‰ç»“åˆä½ç‚¹' },
            'polysaccharide': { name: 'å¤šç³–é“¾', desc: 'è¾ƒé•¿çš„åˆ†æ”¯ç³–é“¾ï¼Œæ„æˆç³–è¼ï¼Œä½äºå¤–ä¾§' },
            'oligosaccharide': { name: 'å¯¡ç³–é“¾', desc: 'è¾ƒçŸ­çš„åˆ†æ”¯ç³–é“¾ï¼Œå¤šè¿æ¥äºç³–è›‹ç™½/ç³–è„‚' }
        };

        // ç»Ÿè®¡é¢æ¿æ˜ å°„
        const typeToCounterId = {
            'phospholipid-up': 'phospholipidUpCount',
            'phospholipid-down': 'phospholipidDownCount',
            'integral-protein': 'integralProteinCount',
            'peripheral-protein': 'peripheralProteinCount',
            'glycoprotein': 'glycoproteinCount',
            'glycolipid': 'glycolipidCount',
            'cholesterol': 'cholesterolCount',
            'channel-protein': 'channelProteinCount',
            'carrier-protein': 'carrierProteinCount',
            'polysaccharide': 'polysaccharideCount',
            'oligosaccharide': 'oligosaccharideCount'
        };

        // æœ¬åœ°å­˜å‚¨é”®å
        const STORAGE_KEY = 'cell-membrane-custom-preset-v1';

        // ç»„ä»¶SVGå®šä¹‰ï¼ˆæ›´è¯¦ç»†ç‰ˆæœ¬ï¼‰
        const componentSVGs = {
            'phospholipid-up': `<svg width="40" height="80" viewBox="0 0 40 80">
                <circle cx="20" cy="14" r="10" fill="#64B5F6" opacity="0.95"/>
                <path d="M15 26 C 12 36, 18 44, 15 52 C 12 58, 18 66, 15 72" stroke="#EF5350" stroke-width="3" fill="none"/>
                <path d="M25 26 C 28 36, 22 44, 25 52 C 28 58, 22 66, 25 72" stroke="#EF5350" stroke-width="3" fill="none"/>
            </svg>`,
            'phospholipid-down': `<svg width="40" height="80" viewBox="0 0 40 80">
                <circle cx="20" cy="66" r="10" fill="#64B5F6" opacity="0.95"/>
                <path d="M15 56 C 12 46, 18 38, 15 30 C 12 24, 18 16, 15 10" stroke="#EF5350" stroke-width="3" fill="none"/>
                <path d="M25 56 C 28 46, 22 38, 25 30 C 28 24, 22 16, 25 10" stroke="#EF5350" stroke-width="3" fill="none"/>
            </svg>`,

            'integral-protein': `<svg width="60" height="200" viewBox="0 0 60 200">
                <path d="M15 24 C 10 60, 10 140, 15 176 L45 176 C 50 140, 50 60, 45 24 Z" fill="#9575CD" opacity="0.95"/>
            </svg>`,

            'peripheral-protein': `<svg width="70" height="50" viewBox="0 0 70 50">
                <ellipse cx="35" cy="25" rx="28" ry="18" fill="#B39DDB" opacity="0.95"/>
            </svg>`,

            'glycoprotein': `<svg width="80" height="60" viewBox="0 0 80 60">
                <rect x="30" y="28" width="20" height="27" rx="6" fill="#7CB342" opacity="0.9"/>
                <!-- ä¸»é“¾å…­è¾¹å½¢ï¼ˆç›¸é‚»æ’åˆ—ï¼Œæ— è¿çº¿ï¼‰ -->
                <polygon points="43,24 41.5,21.4 38.5,21.4 37,24 38.5,26.6 41.5,26.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,18 41.5,15.4 38.5,15.4 37,18 38.5,20.6 41.5,20.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,12 41.5,9.4 38.5,9.4 37,12 38.5,14.6 41.5,14.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,6 41.5,3.4 38.5,3.4 37,6 38.5,8.6 41.5,8.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <!-- å³ä¾§æ”¯é“¾å…­è¾¹å½¢ï¼ˆâ‰¥6 ä¸ªï¼‰ -->
                <polygon points="49,20.5 47.5,17.9 44.5,17.9 43,20.5 44.5,23.1 47.5,23.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="53,18.5 51.5,15.9 48.5,15.9 47,18.5 48.5,21.1 51.5,21.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="57,16.5 55.5,13.9 52.5,13.9 51,16.5 52.5,19.1 55.5,19.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="61,14.5 59.5,11.9 56.5,11.9 55,14.5 56.5,17.1 59.5,17.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="65,12.5 63.5,9.9 60.5,9.9 59,12.5 60.5,15.1 63.5,15.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="69,10.5 67.5,7.9 64.5,7.9 63,10.5 64.5,13.1 67.5,13.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="73,8.5 71.5,5.9 68.5,5.9 67,8.5 68.5,11.1 71.5,11.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="77,6.5 75.5,3.9 72.5,3.9 71,6.5 72.5,9.1 75.5,9.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
            </svg>`,

            'glycolipid': `<svg width="80" height="60" viewBox="0 0 80 60">
                <!-- å¤´éƒ¨ä¸ä¸¤æ¡ç–æ°´å°¾ï¼ˆæ³¢æµªï¼‰ -->
                <circle cx="40" cy="35" r="6" fill="#FF7043"/>
                <path d="M35 41 C 32 46, 38 50, 35 54" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                <path d="M45 41 C 48 46, 42 50, 45 54" stroke="#EF5350" stroke-width="2.5" fill="none"/>
                <!-- ä¸»é“¾å…­è¾¹å½¢ï¼ˆç›¸é‚»æ’åˆ—ï¼‰ -->
                <polygon points="43,25 41.5,22.4 38.5,22.4 37,25 38.5,27.6 41.5,27.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,19 41.5,16.4 38.5,16.4 37,19 38.5,21.6 41.5,21.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="43,13.5 41.5,10.9 38.5,10.9 37,13.5 38.5,16.1 41.5,16.1" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <!-- å³ä¾§æ”¯é“¾å…­è¾¹å½¢ï¼ˆâ‰¥6 ä¸ªï¼‰ -->
                <polygon points="49,21 47.5,18.4 44.5,18.4 43,21 44.5,23.6 47.5,23.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="53,19 51.5,16.4 48.5,16.4 47,19 48.5,21.6 51.5,21.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="57,17 55.5,14.4 52.5,14.4 51,17 52.5,19.6 55.5,19.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="61,15 59.5,12.4 56.5,12.4 55,15 56.5,17.6 59.5,17.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="65,13 63.5,10.4 60.5,10.4 59,13 60.5,15.6 63.5,15.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="69,11 67.5,8.4 64.5,8.4 63,11 64.5,13.6 67.5,13.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="73,9 71.5,6.4 68.5,6.4 67,9 68.5,11.6 71.5,11.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
                <polygon points="77,7 75.5,4.4 72.5,4.4 71,7 72.5,9.6 75.5,9.6" fill="#FFD54F" stroke="#FFA000" stroke-width="0.9"/>
            </svg>`,

            'cholesterol': `<svg width="45" height="60" viewBox="0 0 45 60">
                <polygon points="22.5,12 34,20 34,40 22.5,48 11,40 11,20" fill="#FFB300" opacity="0.95"/>
                <circle cx="22.5" cy="30" r="6" fill="#F57C00"/>
            </svg>`,

            'channel-protein': `<svg width="60" height="200" viewBox="0 0 60 200">
                <!-- è´¯ç©¿å­”é“ä½¿ç”¨é®ç½©å®ç°é•‚ç©ºæ•ˆæœ -->
                <defs>
                    <mask id="channelMaskPlaced">
                        <rect x="0" y="0" width="60" height="200" fill="white"/>
                        <!-- é»‘è‰²åŒºåŸŸä¸ºé•‚ç©ºé€šé“ï¼ˆé¦–å°¾è´¯ç©¿ï¼‰ -->
                        <rect x="22" y="0" width="16" height="200" rx="8" fill="black"/>
                    </mask>
                </defs>
                <rect x="15" y="10" width="30" height="180" rx="14" fill="#9575CD" opacity="0.95" mask="url(#channelMaskPlaced)"/>
            </svg>`,

            'carrier-protein': `<svg width="60" height="200" viewBox="0 0 60 200">
                <!-- é¦–å°¾è´¯ç©¿çš„è½½ä½“è›‹ç™½ï¼šå¤–éƒ¨ä¸»ä½“æ›´åšå® + æ›´çª„çš„é•‚ç©ºé€šé“ + å·¦å³å‡¹æ§½ç»“åˆä½ç‚¹ -->
                <defs>
                    <mask id="carrierMaskPlaced">
                        <rect x="0" y="0" width="60" height="200" fill="white"/>
                        <!-- æ›´çª„çš„è´¯ç©¿é€šé“ï¼ˆå±…ä¸­ï¼‰ -->
                        <rect x="25" y="0" width="10" height="200" rx="6" fill="black"/>
                        <!-- å·¦å³ä¾§å£å„ä¸€ä¸ªåŠåœ†å‡¹æ§½ä½œä¸ºç»“åˆä½ç‚¹ï¼ˆè´´è¿‘é€šé“ï¼‰ -->
                        <circle cx="25" cy="100" r="6.5" fill="black"/>
                        <circle cx="35" cy="100" r="6.5" fill="black"/>
                    </mask>
                </defs>
                <!-- å¤–éƒ¨ä¸»ä½“æ›´åšå®ï¼ˆå¢å®½ï¼‰ -->
                <rect x="12" y="10" width="36" height="180" rx="16" fill="#7E57C2" opacity="0.95" mask="url(#carrierMaskPlaced)"/>
            </svg>`,
            'polysaccharide': `<svg width="80" height="120" viewBox="0 0 80 120">
                <!-- ä¸»é“¾ï¼šçºµå‘å…­è¾¹å½¢ï¼ˆæ›´é•¿ï¼‰ -->
                <polygon points="43,100 41.5,97.4 38.5,97.4 37,100 38.5,102.6 41.5,102.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,92 41.5,89.4 38.5,89.4 37,92 38.5,94.6 41.5,94.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,84 41.5,81.4 38.5,81.4 37,84 38.5,86.6 41.5,86.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,76 41.5,73.4 38.5,73.4 37,76 38.5,78.6 41.5,78.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,68 41.5,65.4 38.5,65.4 37,68 38.5,70.6 41.5,70.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,60 41.5,57.4 38.5,57.4 37,60 38.5,62.6 41.5,62.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="43,52 41.5,49.4 38.5,49.4 37,52 38.5,54.6 41.5,54.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <!-- å³ä¾§è¾ƒé•¿æ”¯é“¾ï¼šâ‰¥6 ä¸ªå…­è¾¹å½¢ï¼Œæ–œå‘æ’åˆ— -->
                <polygon points="49,96.5 47.5,93.9 44.5,93.9 43,96.5 44.5,99.1 47.5,99.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="53,94.5 51.5,91.9 48.5,91.9 47,94.5 48.5,97.1 51.5,97.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="57,92.5 55.5,89.9 52.5,89.9 51,92.5 52.5,95.1 55.5,95.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="61,90.5 59.5,87.9 56.5,87.9 55,90.5 56.5,93.1 59.5,93.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="65,88.5 63.5,85.9 60.5,85.9 59,88.5 60.5,91.1 63.5,91.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="69,86.5 67.5,83.9 64.5,83.9 63,86.5 64.5,89.1 67.5,89.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="73,84.5 71.5,81.9 68.5,81.9 67,84.5 68.5,87.1 71.5,87.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
                <polygon points="77,82.5 75.5,79.9 72.5,79.9 71,82.5 72.5,85.1 75.5,85.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.2"/>
            </svg>`,
            'oligosaccharide': `<svg width="80" height="100" viewBox="0 0 80 100">
                <!-- ä¸»é“¾ï¼šçºµå‘è¾ƒçŸ­ï¼ˆ3 ä¸ªï¼‰ -->
                <polygon points="43,72 41.5,69.4 38.5,69.4 37,72 38.5,74.6 41.5,74.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="43,64 41.5,61.4 38.5,61.4 37,64 38.5,66.6 41.5,66.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="43,56 41.5,53.4 38.5,53.4 37,56 38.5,58.6 41.5,58.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="43,48 41.5,45.4 38.5,45.4 37,48 38.5,50.6 41.5,50.6" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <!-- å³ä¾§çŸ­æ”¯é“¾ï¼š3 ä¸ªå…­è¾¹å½¢ -->
                <polygon points="49,68.5 47.5,65.9 44.5,65.9 43,68.5 44.5,71.1 47.5,71.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="53,66.5 51.5,63.9 48.5,63.9 47,66.5 48.5,69.1 51.5,69.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="57,64.5 55.5,61.9 52.5,61.9 51,64.5 52.5,67.1 55.5,67.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
                <polygon points="61,62.5 59.5,59.9 56.5,59.9 55,62.5 56.5,65.1 59.5,65.1" fill="#FFD54F" stroke="#FFA000" stroke-width="1.1"/>
            </svg>`
        };

        // åˆå§‹åŒ–æ‹–æ‹½ï¼ˆå·¦ä¾§é¢æ¿ -> ç”»å¸ƒï¼‰
        document.querySelectorAll('.component-item').forEach(item => {
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
            item.addEventListener('click', () => selectItemForPlace(item));
        });

        canvas.addEventListener('dragover', handleDragOver);
        canvas.addEventListener('drop', handleDrop);
        canvas.addEventListener('dragleave', handleDragLeave);
        canvas.addEventListener('click', handleCanvasClickToPlace);
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') clearSelection(); });
        canvas.addEventListener('mousemove', (e) => {
            const p = screenToContent(e.clientX, e.clientY);
            updateStatus(p);
        });

        // ç”»å¸ƒç¼©æ”¾ï¼ˆé»˜è®¤æ”¾å¤§ 2 å€ï¼›å…³é—­æ‰‹åŠ¿ç¼©æ”¾ï¼Œå¯ç”¨æŒ‰é’®æ§åˆ¶ï¼‰
        const ENABLE_GESTURE_ZOOM = false;
        let zoomScale = 2;
        const MIN_ZOOM = 0.5;
        const MAX_ZOOM = 3;
        let pinchStartDist = 0;
        let pinchStartScale = 2;

        // Studioã€ç½‘æ ¼ã€å¸é™„
        let studioEnabled = false;
        let gridEnabled = false;
        let snapEnabled = false;
        const GRID_SIZE = 10;

        function setZoom(next, originX = null, originY = null) {
            zoomScale = Math.min(MAX_ZOOM, Math.max(MIN_ZOOM, next));
            if (originX != null && originY != null) {
                content.style.transformOrigin = `${originX}px ${originY}px`;
            }
            content.style.transform = `scale(${zoomScale})`;
            updateStatus();
        }

        function distance(touches) {
            const dx = touches[0].clientX - touches[1].clientX;
            const dy = touches[0].clientY - touches[1].clientY;
            return Math.hypot(dx, dy);
        }
        if (ENABLE_GESTURE_ZOOM) {
            canvas.addEventListener('touchstart', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    pinchStartDist = distance(e.touches);
                    pinchStartScale = zoomScale;
                }
            }, { passive: false });

            canvas.addEventListener('touchmove', (e) => {
                if (e.touches.length === 2) {
                    e.preventDefault();
                    const curDist = distance(e.touches);
                    const factor = curDist / pinchStartDist;
                    setZoom(pinchStartScale * factor);
                }
            }, { passive: false });

            canvas.addEventListener('touchend', () => { pinchStartDist = 0; });
            canvas.addEventListener('touchcancel', () => { pinchStartDist = 0; });

            canvas.addEventListener('wheel', (e) => {
                if (!e.ctrlKey) return;
                e.preventDefault();
                const rect = canvas.getBoundingClientRect();
                const pointerX = (e.clientX - rect.left) / zoomScale;
                const pointerY = (e.clientY - rect.top) / zoomScale;
                const delta = -e.deltaY;
                const factor = Math.exp(delta * 0.0015);
                setZoom(zoomScale * factor, pointerX, pointerY);
            }, { passive: false });
        } else {
            // é»˜è®¤åˆå§‹åŒ–ä¸º 2x ç¼©æ”¾
            setZoom(zoomScale);
        }

        // è¾…åŠ©ï¼šå±å¹•åæ ‡ -> å†…å®¹åæ ‡ï¼ˆè€ƒè™‘ç¼©æ”¾ä¸ä¸­å¿ƒä¸ºåŸç‚¹ï¼‰
        function screenToContent(clientX, clientY) {
            const rect = canvas.getBoundingClientRect();
            const originX = canvas.clientWidth / 2;
            const originY = canvas.clientHeight / 2;
            const sx = clientX - rect.left;
            const sy = clientY - rect.top;
            const cx = (sx - originX) / zoomScale + originX;
            const cy = (sy - originY) / zoomScale + originY;
            return { x: cx, y: cy };
        }

        // å·¥å…·æ æ“ä½œ
        function toggleStudio() {
            studioEnabled = !studioEnabled;
            document.getElementById('studioBtn')?.classList.toggle('active', studioEnabled);
            canvas.classList.toggle('studio', studioEnabled);
        }
        function toggleGrid() {
            gridEnabled = !gridEnabled;
            document.getElementById('gridBtn')?.classList.toggle('active', gridEnabled);
            gridOverlay.style.display = gridEnabled ? 'block' : 'none';
            updateStatus();
        }
        function toggleSnap() {
            snapEnabled = !snapEnabled;
            document.getElementById('snapBtn')?.classList.toggle('active', snapEnabled);
            updateStatus();
        }
        function zoomIn() { setZoom(Math.min(MAX_ZOOM, zoomScale * 1.15)); }
        function zoomOut() { setZoom(Math.max(MIN_ZOOM, zoomScale / 1.15)); }
        function resetView() { setZoom(2); }

        function updateStatus(pt) {
            if (pt) {
                statusPos.textContent = `X: ${Math.round(pt.x)}ï¼ŒY: ${Math.round(pt.y)}`;
            }
            statusZoom.textContent = `ç¼©æ”¾: ${zoomScale.toFixed(2)}x`;
            statusFlags.textContent = `ç½‘æ ¼: ${gridEnabled ? 'å¼€' : 'å…³'} | å¸é™„: ${snapEnabled ? 'å¼€' : 'å…³'}`;
        }

        function handleDragStart(e) {
            draggedElement = e.target.closest('.component-item');
            if (!draggedElement) return;
            draggedElement.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'copy';
            const data = {
                type: draggedElement.dataset.type,
                name: draggedElement.dataset.name
            };
            try {
                e.dataTransfer.setData('application/json', JSON.stringify(data));
            } catch (_) {
                // æŸäº›æµè§ˆå™¨å¯èƒ½ä¸å…è®¸è‡ªå®šä¹‰ç±»å‹ï¼Œå›é€€åˆ° text/plain
                e.dataTransfer.setData('text/plain', JSON.stringify(data));
            }
        }

        function handleDragEnd() {
            if (draggedElement) draggedElement.classList.remove('dragging');
            draggedElement = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            canvas.classList.add('drag-over');
            if (e.dataTransfer) e.dataTransfer.dropEffect = 'copy';
        }

        function handleDragLeave() {
            canvas.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            canvas.classList.remove('drag-over');
            let raw = e.dataTransfer.getData('application/json') || e.dataTransfer.getData('text/plain');
            if (!raw) return;
            let payload = {};
            try { payload = JSON.parse(raw); } catch (_) { return; }
            const p2 = screenToContent(e.clientX, e.clientY);
            createPlacedComponent(payload.type, p2.x, p2.y);
        }

        // é€‰æ‹©ç»„ä»¶ä»¥ç‚¹å‡»æ”¾ç½®
        function selectItemForPlace(item) {
            clearSelection();
            selectedType = item.dataset.type;
            selectedItemEl = item;
            item.classList.add('selected');
            canvas.classList.add('placing');
        }

        function clearSelection() {
            selectedType = null;
            if (selectedItemEl) selectedItemEl.classList.remove('selected');
            selectedItemEl = null;
            canvas.classList.remove('placing');
        }

        // ç‚¹å‡»ç”»å¸ƒæ”¾ç½®
        function handleCanvasClickToPlace(e) {
            if (!selectedType) return;
            // ä»…åœ¨ç‚¹å‡»ç©ºç™½ç”»å¸ƒï¼ˆå®¹å™¨æˆ–å†…å®¹å±‚ï¼‰æ—¶æ”¾ç½®
            const valid = e.target === canvas || e.target === content;
            if (!valid) return;
            const p1 = screenToContent(e.clientX, e.clientY);
            const x = p1.x;
            const y = p1.y;
            createPlacedComponent(selectedType, x, y);
            // å¦‚éœ€å•æ¬¡æ”¾ç½®ï¼Œæ”¹ä¸ºï¼šclearSelection();
        }

        // åˆ›å»ºå¹¶æ”¾ç½®ç»„ä»¶åˆ°ç”»å¸ƒ
        function createPlacedComponent(type, x, y) {
            if (!componentSVGs[type]) return;
            const el = document.createElement('div');
            el.className = 'placed-component';
            el.dataset.type = type;
            el.innerHTML = `${componentSVGs[type]}`;
            content.appendChild(el);

            // åˆå§‹ä½ç½®ï¼ˆå…ˆæ”¾ä¸­ç‚¹ï¼Œå†çŸ«æ­£ï¼‰
            const w = el.offsetWidth;
            const h = el.offsetHeight;
            const canvasRect = canvas.getBoundingClientRect(); // ç”¨äºè¾¹ç•ŒèŒƒå›´
            let left = x - w / 2;
            let top = y - h / 2;
            if (snapEnabled) {
                left = Math.round(left / GRID_SIZE) * GRID_SIZE;
                top = Math.round(top / GRID_SIZE) * GRID_SIZE;
            }
            // çº¦æŸåœ¨ç”»å¸ƒå†…
            left = Math.max(0, Math.min(left, canvas.clientWidth - w));
            top = Math.max(0, Math.min(top, canvas.clientHeight - h));
            el.style.left = left + 'px';
            el.style.top = top + 'px';

            // æ ¹æ®å¼€å…³æ§åˆ¶åŠ¨æ•ˆ
            applyMotionToElement(el);

            // ç»‘å®šäº¤äº’
            makeDraggableWithinCanvas(el);
            bindTooltip(el);
            el.addEventListener('dblclick', () => removePlacedComponent(el));

            // ç»Ÿè®¡æ›´æ–°
            incrementCount(type);
        }

        function removePlacedComponent(el) {
            const type = el.dataset.type;
            el.remove();
            decrementCount(type);
        }

        // ä¿å­˜/åŠ è½½è‡ªå®šä¹‰ç¤ºä¾‹
        function saveCustomPreset() {
            const items = Array.from(document.querySelectorAll('#canvasContent .placed-component')).map(el => {
                const left = parseFloat(el.style.left) || 0;
                const top = parseFloat(el.style.top) || 0;
                const cx = left + el.offsetWidth / 2;
                const cy = top + el.offsetHeight / 2;
                return { type: el.dataset.type, cx, cy };
            });
            const payload = { version: 1, items };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
                alert('å·²ä¿å­˜å½“å‰ç»„è£…ä¸ºâ€œæˆ‘çš„ç¤ºä¾‹â€ã€‚');
            } catch (err) {
                console.error(err);
                alert('ä¿å­˜å¤±è´¥ï¼šè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸æœ¬åœ°å­˜å‚¨ã€‚');
            }
        }

        function loadCustomPreset() {
            const raw = localStorage.getItem(STORAGE_KEY);
            if (!raw) { alert('å°šæœªä¿å­˜â€œæˆ‘çš„ç¤ºä¾‹â€ã€‚'); return; }
            let data; try { data = JSON.parse(raw); } catch { alert('ç¤ºä¾‹æ•°æ®å·²æŸåã€‚'); return; }
            if (!data || !Array.isArray(data.items)) { alert('ç¤ºä¾‹æ•°æ®æ ¼å¼ä¸æ­£ç¡®ã€‚'); return; }
            clearCanvas();
            data.items.forEach(it => {
                if (!it || !it.type) return;
                const cx = Number(it.cx) || 0;
                const cy = Number(it.cy) || 0;
                createPlacedComponent(it.type, cx, cy);
            });
        }

        function makeDraggableWithinCanvas(el) {
            let offsetX = 0, offsetY = 0;
            function onMouseMove(moveEvent) {
                const elW = el.offsetWidth;
                const elH = el.offsetHeight;
                const p = screenToContent(moveEvent.clientX, moveEvent.clientY);
                let left = p.x - offsetX;
                let top = p.y - offsetY;
                if (snapEnabled) {
                    left = Math.round(left / GRID_SIZE) * GRID_SIZE;
                    top = Math.round(top / GRID_SIZE) * GRID_SIZE;
                }
                left = Math.max(0, Math.min(left, canvas.clientWidth - elW));
                top = Math.max(0, Math.min(top, canvas.clientHeight - elH));
                el.style.left = left + 'px';
                el.style.top = top + 'px';
            }
            function onMouseUp() {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
                if (motionEnabled) applyMotionToElement(el);
            }
            el.addEventListener('mousedown', (downEvent) => {
                if (downEvent.button !== 0) return;
                const left0 = parseFloat(el.style.left) || 0;
                const top0 = parseFloat(el.style.top) || 0;
                const p = screenToContent(downEvent.clientX, downEvent.clientY);
                offsetX = p.x - left0;
                offsetY = p.y - top0;
                // æ‹–åŠ¨å¼€å§‹æ—¶éšè—æç¤º
                tooltip.style.display = 'none';
                // æ‹–åŠ¨è¿‡ç¨‹ä¸­ç§»é™¤åŠ¨æ•ˆï¼Œé¿å…å¹²æ‰°
                clearMotionFromElement(el);
                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp);
                downEvent.preventDefault();
            });
        }

        // è¿åŠ¨æ§åˆ¶å‡½æ•°
        function applyMotionToElement(el) {
            if (!motionEnabled) return;
            clearMotionFromElement(el);
            if (Math.random() > 0.5) el.classList.add('floating');
            else el.classList.add('pulsing');
        }
        function clearMotionFromElement(el) {
            el.classList.remove('floating');
            el.classList.remove('pulsing');
        }
        function applyMotionToAll() {
            document.querySelectorAll('#canvasContent .placed-component').forEach(applyMotionToElement);
        }
        function clearMotionFromAll() {
            document.querySelectorAll('#canvasContent .placed-component').forEach(clearMotionFromElement);
        }
        function toggleMotion() {
            motionEnabled = !motionEnabled;
            const btn = document.getElementById('motionToggleBtn');
            if (motionEnabled) {
                btn.textContent = 'åœæ­¢è¿åŠ¨';
                btn.classList.add('active');
                applyMotionToAll();
            } else {
                btn.textContent = 'å¼€å¯è¿åŠ¨';
                btn.classList.remove('active');
                clearMotionFromAll();
            }
        }

        function bindTooltip(el) {
            const type = el.dataset.type;
            const info = componentInfo[type] || { name: type, desc: '' };
            function onEnter() { tooltip.style.display = 'block'; }
            function onMove(e) {
                const content = `<strong>${info.name}</strong><br><span style="opacity:.9">${info.desc}</span>`;
                tooltip.innerHTML = content;
                const padding = 12;
                const rect = canvas.getBoundingClientRect();
                let x = e.clientX - rect.left + padding;
                let y = e.clientY - rect.top + padding;
                // ä¿è¯ä¸è¶…å‡ºç”»å¸ƒ
                const maxX = rect.width - tooltip.offsetWidth - 8;
                const maxY = rect.height - tooltip.offsetHeight - 8;
                tooltip.style.left = Math.min(x, maxX) + 'px';
                tooltip.style.top = Math.min(y, maxY) + 'px';
            }
            function onLeave() { tooltip.style.display = 'none'; }
            el.addEventListener('mouseenter', onEnter);
            el.addEventListener('mousemove', onMove);
            el.addEventListener('mouseleave', onLeave);
        }

        // ç»Ÿè®¡é€»è¾‘
        function resetCounts() {
            componentCounts = {};
            Object.keys(typeToCounterId).forEach(t => componentCounts[t] = 0);
            updateStats();
        }

        function incrementCount(type) {
            if (!(type in componentCounts)) componentCounts[type] = 0;
            componentCounts[type]++;
            updateStats();
        }

        function decrementCount(type) {
            if (!(type in componentCounts)) return;
            componentCounts[type] = Math.max(0, componentCounts[type] - 1);
            updateStats();
        }

        function updateStats() {
            Object.entries(typeToCounterId).forEach(([type, id]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = componentCounts[type] || 0;
            });
        }

        // è§†å›¾ä¸èƒŒæ™¯æ¸²æŸ“
        let backgroundVisible = false;
        function renderMembraneBackground() {
            const bg = document.getElementById('membraneBackground');
            const width = canvas.clientWidth || 1200;
            const height = 200; // å›ºå®šèƒŒæ™¯å±‚é«˜åº¦

            if (currentView === 'side') {
                // ä¾§è§†ï¼šä¸Šä¸‹ä¸¤æ’å¤´éƒ¨ï¼›èƒŒæ™¯çº¯ç™½
                const heads = Math.max(12, Math.floor(width / 60));
                const topY = 40, bottomY = 160;
                const tailTop = 60, tailBottom = 140;
                const spacing = width / (heads + 1);

                let circlesTop = '';
                let circlesBottom = '';
                let tails = '';
                for (let i = 1; i <= heads; i++) {
                    const cx = Math.round(i * spacing);
                    circlesTop += `<circle cx="${cx}" cy="${topY}" r="8" fill="#64B5F6" opacity="0.95"/>`;
                    circlesBottom += `<circle cx="${cx}" cy="${bottomY}" r="8" fill="#64B5F6" opacity="0.95"/>`;
                    // æ³¢æµªå½¢ç–æ°´å°¾ï¼ˆçº¢è‰²ï¼‰
                    const path1 = `M ${cx-3} ${tailTop} C ${cx-6} ${tailTop+12}, ${cx} ${tailTop+24}, ${cx-3} ${tailTop+36} C ${cx-6} ${tailTop+44}, ${cx} ${tailTop+56}, ${cx-3} ${tailBottom}`;
                    const path2 = `M ${cx+3} ${tailTop} C ${cx+6} ${tailTop+12}, ${cx} ${tailTop+24}, ${cx+3} ${tailTop+36} C ${cx+6} ${tailTop+44}, ${cx} ${tailTop+56}, ${cx+3} ${tailBottom}`;
                    tails += `<path d="${path1}" stroke="#EF5350" stroke-width="2.5" fill="none" opacity="0.7"/>`;
                    tails += `<path d="${path2}" stroke="#EF5350" stroke-width="2.5" fill="none" opacity="0.7"/>`;
                }

                bg.innerHTML = `
                    <svg width="100%" height="${height}" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                        <rect x="0" y="0" width="${width}" height="${height}" fill="#ffffff"/>
                        ${tails}
                        ${circlesTop}
                        ${circlesBottom}
                    </svg>
                `;
            } else {
                // ä¿¯è§†ï¼šå¤´éƒ¨åœ¨ä¸¤ä¾§è¾¹ç¼˜çš„ç¨ å¯†åˆ†å¸ƒï¼›èƒŒæ™¯çº¯ç™½
                const cols = Math.max(16, Math.floor(width / 50));
                const rows = 4;
                const spacingX = width / (cols + 1);
                const spacingY = height / (rows + 1);
                let dots = '';
                for (let r = 1; r <= rows; r++) {
                    for (let c = 1; c <= cols; c++) {
                        const cx = Math.round(c * spacingX);
                        const cy = Math.round(r * spacingY);
                        const color = r <= 2 ? '#2196F3' : '#FF5722';
                        dots += `<circle cx="${cx}" cy="${cy}" r="6" fill="${color}" opacity="0.9"/>`;
                    }
                }
                bg.innerHTML = `
                    <svg width="100%" height="${height}" viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
                        <rect x="0" y="0" width="${width}" height="${height}" fill="#ffffff"/>
                        ${dots}
                    </svg>
                `;
            }
            backgroundVisible = true;
        }

        // å–æ¶ˆåˆ‡æ¢è§†è§’åŠŸèƒ½ï¼šä¿ç•™èƒŒæ™¯æ¸²æŸ“æ–¹æ³•ä»¥å¤‡å°†æ¥éœ€è¦ï¼Œä½†ä¸å†æä¾›åˆ‡æ¢å…¥å£

        function clearCanvas() {
            document.querySelectorAll('#membraneCanvas .placed-component').forEach(el => el.remove());
            resetCounts();
        }

        function loadPreset() {
            clearCanvas();
            // ç”Ÿæˆä¸€ç»„å…¸å‹åˆ†å¸ƒ
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            const midY = height / 2;

            // ä¸¤æ’ç£·è„‚ï¼ˆåŒåˆ†å­å±‚ï¼‰æ›´ç´§å‡‘ï¼šæ•°é‡è¿›ä¸€æ­¥å¢åŠ ã€å·¦å³è¾¹è·æ›´çª„
            const n = 36; // å†å¢åŠ æ•°é‡ï¼Œè¿›ä¸€æ­¥å‹ç¼©æ°´å¹³é—´è·
            const marginX = Math.max(3, Math.floor(width * 0.01)); // æ›´å°çš„å·¦å³è¾¹è·
            const usable = width - 2 * marginX;
            const spacing = usable / (n - 1);
            const deltaY = 45; // ä¸Šä¸‹å±‚è·ç¦»ç¼©åˆ° 45

            // ä¸ºä¸‰ç±»è·¨è†œè›‹ç™½é¢„ç•™ç©ºæ¡£ï¼Œé¿å…ä¸ç£·è„‚é‡å 
            const reservedXs = [width * 0.12, width * 0.50, width * 0.88];
            const reservedRadius = 45; // ç©ºæ¡£ç¨å¾®ç¼©å°ï¼Œæ•´ä½“æ›´ç´§å‡‘

            for (let i = 0; i < n; i++) {
                const x = marginX + i * spacing;
                const nearReserved = reservedXs.some(rx => Math.abs(x - rx) < reservedRadius);
                if (nearReserved) continue; // åœ¨ç©ºæ¡£ä½ç½®ä¸æ”¾ç£·è„‚
                // ä¸Šå±‚ï¼šæ­£ç½®ï¼ˆå¤´æœå¤–ï¼Œå‘ä¸Šï¼‰
                createPlacedComponent('phospholipid-up', x, midY - deltaY);
                // ä¸‹å±‚ï¼šå€’ç½®ï¼ˆå¤´æœå¤–ï¼Œå‘ä¸‹ï¼‰
                createPlacedComponent('phospholipid-down', x, midY + deltaY);
            }

            // èƒ†å›ºé†‡ï¼ˆåµŒå…¥ç–æ°´åŒºï¼‰æ›´å¯†ä¸€äº›
            for (let i = 1; i < n - 1; i += 2) {
                const x = marginX + i * spacing + (Math.random() * 10 - 5);
                const nearReserved = reservedXs.some(rx => Math.abs(x - rx) < reservedRadius - 10);
                if (nearReserved) continue;
                createPlacedComponent('cholesterol', x, midY + (Math.random() * 8 - 4));
            }

            // è·¨è†œ/é€šé“/è½½ä½“è›‹ç™½ï¼ˆè·¨è¶ŠåŒå±‚ï¼‰å°½å¯èƒ½åˆ†æ•£ï¼ˆå·¦/ä¸­/å³ï¼‰ï¼Œå„è‡ªå æ®é¢„ç•™ç©ºæ¡£
            createPlacedComponent('integral-protein', reservedXs[0], midY);
            createPlacedComponent('channel-protein',  reservedXs[1], midY);
            createPlacedComponent('carrier-protein',  reservedXs[2], midY);

            // å¤–å‘¨è›‹ç™½ï¼ˆå†…å¤–è¡¨é¢ï¼‰åˆ†æ•£åœ¨æ›´è¿œå·¦å³ï¼Œä¸”ä¸ä¸ç£·è„‚å±‚é‡å 
            createPlacedComponent('peripheral-protein', width * 0.08, midY - (deltaY + 60));
            createPlacedComponent('peripheral-protein', width * 0.92, midY + (deltaY + 60));

            // ç³–ç±»ï¼ˆå¤–ä¾§ï¼‰åˆ†æ•£ï¼šåå·¦/åå³ï¼Œä¸”æ˜æ˜¾åœ¨ç£·è„‚å±‚ä¹‹å¤–
            createPlacedComponent('glycoprotein', width * 0.28, midY - (deltaY + 90));
            createPlacedComponent('glycolipid',  width * 0.72, midY - (deltaY + 92));
            // å¤šç³–/å¯¡ç³–é“¾ï¼ˆæ›´å¤–ä¸”åˆ†æ•£ï¼‰
            createPlacedComponent('polysaccharide',  width * 0.18, midY - (deltaY + 110));
            createPlacedComponent('oligosaccharide', width * 0.82, midY - (deltaY + 120));
        }

        // åˆå§‹æ¸²æŸ“
        resetCounts();
        // èµ·å§‹ç”»æ¿ä¿æŒç©ºç™½ï¼Œä¸æ¸²æŸ“èƒŒæ™¯
        window.addEventListener('resize', () => { if (backgroundVisible) renderMembraneBackground(); });
    </script>
</body>
</html>
